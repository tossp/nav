import{a as G}from"./chunk-AR25ZNIJ.js";import{a as R,b as j}from"./chunk-GOUXAGER.js";import{a as J}from"./chunk-NPZIPQC7.js";import{a as $,b as D}from"./chunk-A4EMC7TR.js";import"./chunk-NIG3VI6X.js";import{Lb as W,Mb as F,Tb as H,cb as T,fb as O,pb as L,zb as q}from"./chunk-BNMAPOJX.js";import{Bb as v,Nb as m,Ob as c,Pb as u,Qd as B,Td as A,Wb as _,Yb as y,bd as z,f as b,fc as p,gb as s,gc as k,hb as f,hc as x,jc as S,jd as M,lc as C,mc as E,nc as w,pc as N,ra as I,vb as g,yd as P,zb as d}from"./chunk-PY64W4FA.js";var U=b(G());var V=b(q());function K(a,n){a&1&&u(0,"nz-spin",10)}function Q(a,n){if(a&1&&(m(0,"p",11),p(1),c()),a&2){let o=y();s(),x("\u8017\u65F6 ",o.seconds," \u79D2")}}function X(a,n){if(a&1&&(m(0,"p",11),p(1),c()),a&2){let o=y();s(),S(" ",o.$t("_processing")," ",o.currentNumber," / ",o.countAll," ")}}var h=class a{constructor(n,o){this.message=n;this.notification=o}$t=A;submitting=!1;websiteList=B;isExportIcon=!1;seconds=0;currentNumber=0;countAll=0;ngOnInit(){}loadImage(n){return new Promise(o=>{if(!n)return o(null);let e=new Image;e.crossOrigin="Anonymous",e.onload=function(){o(e)},e.onerror=function(){o(null)},e.src=n})}async imageToBase64(n,o=!0){let e=await this.loadImage(n.icon);if(e)try{let i=document.createElement("canvas");i.width=32,i.height=32,i.getContext("2d").drawImage(e,0,0,32,32);let t=i.toDataURL();return n.icon=t,t}catch{}else{if(!o)return;try{if(!n.icon)return;let r=await F({url:n.icon});r.data.base64&&(n.icon=r.data.base64,await this.imageToBase64(n,!1))}catch(r){let i=document.getElementById("error-msg");if(i){let l=`
          <a href="${n.icon}" target="_blank">${n.name} ${n.icon}</a>
          <div>${r.response?.data?.message||r.message}</div>
        `;i.innerHTML=l+i.innerHTML}}}}async bookmarksExport(){if(!P())return this.notification.error("Error","\u8BF7\u6388\u6743");if(this.submitting)return;let n=this;this.seconds=0,this.countAll=0,this.currentNumber=0,this.submitting=!0;let o=setInterval(()=>{this.seconds+=1},1e3),e=JSON.parse(JSON.stringify(this.websiteList)),r=[];function i(l){Array.isArray(l)&&l.forEach(t=>{delete t.id,delete t.createdAt,delete t.rate,delete t.top,delete t.topTypes,delete t.index,delete t.ownVisible,delete t.breadcrumb,delete t.ok,delete t.__name__,delete t.__desc__,delete t.collapsed,delete t.tags,Array.isArray(t.nav)&&i(t.nav),t.url&&r.push(n.imageToBase64(t).finally(()=>{n.currentNumber+=1}))})}this.isExportIcon&&(i(e),this.countAll=r.length,await Promise.allSettled(r)),W({data:V.default.compress(JSON.stringify(e))}).then(l=>{let t="\u53D1\u73B0\u5BFC\u822A\u4E66\u7B7E.html",Z=new Blob([l.data.data],{type:"text/html;charset=utf-8"});(0,U.saveAs)(Z,t),this.notification.success("\u5BFC\u51FA\u6210\u529F",t,{nzDuration:0})}).finally(()=>{this.submitting=!1,clearInterval(o)})}static \u0275fac=function(o){return new(o||a)(f(H),f(J))};static \u0275cmp=I({type:a,selectors:[["system-bookmark-export"]],standalone:!0,features:[N],decls:16,vars:9,consts:[["nzSimple","","nzSize","large","class","text-center",4,"ngIf"],[1,"text-center"],[3,"ngModelChange","ngModel"],[1,"ml-2.5"],["class","mt-2.5",4,"ngIf"],[1,"book-wrapper","mt-2.5"],["src","assets/img/bookmark.svg","draggable","false",1,"logo",3,"click"],[1,"whitespace-nowrap","mt-2.5",3,"click"],[1,"err"],["id","error-msg"],["nzSimple","","nzSize","large",1,"text-center"],[1,"mt-2.5"]],template:function(o,e){o&1&&(g(0,K,1,0,"nz-spin",0),m(1,"div",1)(2,"nz-switch",2),w("ngModelChange",function(i){return E(e.isExportIcon,i)||(e.isExportIcon=i),i}),c(),m(3,"span",3),p(4),c(),g(5,Q,2,1,"p",4)(6,X,2,3,"p",4),c(),m(7,"div",5)(8,"div")(9,"img",6),_("click",function(){return e.bookmarksExport()}),c(),m(10,"p",7),_("click",function(){return e.bookmarksExport()}),p(11),c()()(),m(12,"div",8)(13,"h2"),p(14),c(),u(15,"pre",9),c()),o&2&&(d("ngIf",e.submitting),s(2),C("ngModel",e.isExportIcon),s(2),k(e.$t("_exportIcons")),s(),d("ngIf",e.seconds>0),s(),d("ngIf",e.countAll>0),s(5),x(" ",e.$t("_clickExport")," "),s(),v("noopacity",e.countAll>0),s(2),k(e.$t("_errorIcons")))},dependencies:[M,z,j,R,D,$,L,T,O],styles:[".book-wrapper[_ngcontent-%COMP%]{text-align:center}.book-wrapper[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%], .book-wrapper[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer}#error-msg[_ngcontent-%COMP%]{white-space:pre-line;background-color:#f2f2f2;border-radius:8px;padding:0 12px}.err[_ngcontent-%COMP%]{opacity:0}.err.noopacity[_ngcontent-%COMP%]{opacity:1}"]})};export{h as default};
